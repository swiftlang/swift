if(CMAKE_SYSTEM_NAME STREQUAL "Darwin" AND DEFINED SWIFT_STDLIB_LIBRARY_BUILD_TYPES)

  set(library_name "swiftCompatibilitySpan")

  add_swift_target_library("${library_name}" ${SWIFT_STDLIB_LIBRARY_BUILD_TYPES} IS_STDLIB
    FakeStdlib.swift
    ../../public/core/Span/MutableRawSpan.swift
    ../../public/core/Span/MutableSpan.swift
    ../../public/core/Span/RawSpan.swift
    ../../public/core/Span/Span.swift

    TARGET_SDKS ${SWIFT_APPLE_PLATFORMS}

    LINK_FLAGS "${SWIFT_RUNTIME_SWIFT_LINK_FLAGS}"

    SWIFT_COMPILE_FLAGS
      ${SWIFT_STANDARD_LIBRARY_SWIFT_FLAGS}
      -parse-stdlib
      -module-abi-name Swift
      -DSPAN_COMPATIBILITY_STUB

    NO_SWIFTMODULE

    DEPLOYMENT_VERSION_OSX ${COMPATIBILITY_MINIMUM_DEPLOYMENT_VERSION_OSX}
    DEPLOYMENT_VERSION_IOS ${COMPATIBILITY_MINIMUM_DEPLOYMENT_VERSION_IOS}
    DEPLOYMENT_VERSION_TVOS ${COMPATIBILITY_MINIMUM_DEPLOYMENT_VERSION_TVOS}
    DEPLOYMENT_VERSION_WATCHOS ${COMPATIBILITY_MINIMUM_DEPLOYMENT_VERSION_WATCHOS}
    DEPLOYMENT_VERSION_XROS ${COMPATIBILITY_MINIMUM_DEPLOYMENT_VERSION_XROS}
    DEPLOYMENT_VERSION_MACCATALYST ${COMPATIBILITY_MINIMUM_DEPLOYMENT_VERSION_MACCATALYST}

    MACCATALYST_BUILD_FLAVOR "zippered"

    INSTALL_IN_COMPONENT compiler

    LINK_FLAGS "${SWIFT_RUNTIME_SWIFT_LINK_FLAGS}" -Xlinker -not_for_dyld_shared_cache

    BACK_DEPLOYMENT_LIBRARY 6.2)
endif()
