// RUN: %target-sil-opt -sil-print-types -enable-sil-verify-all %s -onone-simplification -simplify-instruction=copy_value | %FileCheck %s

// REQUIRES: swift_in_compiler

sil_stage canonical

import Builtin
import Swift
import SwiftShims

sil @cl : $@convention(thin) () -> Int

actor A {}

// CHECK-LABEL: sil [ossa] @remove_copy :
// CHECK:         [[F:%.*]] = thin_to_thick_function %0 : $@convention(thin) () -> Int to $@callee_guaranteed () -> Int
// CHECK-NEXT:    destroy_value [[F]]
// CHECK:       } // end sil function 'remove_copy'
sil [ossa] @remove_copy : $@convention(thin) () -> () {
bb0:
  %0 = function_ref @cl : $@convention(thin) () -> Int
  %1 = thin_to_thick_function %0 : $@convention(thin) () -> Int to $@callee_guaranteed () -> Int
  %2 = copy_value %1 : $@callee_guaranteed () -> Int
  destroy_value %2 : $@callee_guaranteed () -> Int
  %4 = tuple ()
  return %4 : $()
}

// CHECK-LABEL: sil [ossa] @dont_remove_copy_of_idra_builtin :
// CHECK:         %2 = copy_value %1
// CHECK:       } // end sil function 'dont_remove_copy_of_idra_builtin'
sil [ossa] @dont_remove_copy_of_idra_builtin : $@convention(thin) @async () -> @owned (A, A) {
bb0:
  %0 = metatype $@thick A.Type
  %1 = builtin "initializeDistributedRemoteActor"(%0) : $A
  %2 = copy_value %1
  %3 = tuple (%1, %2)
  return %3
}

