//===--- TypeAttr.def - Swift Attributes Metaprogramming --------*- C++ -*-===//
//
// This source file is part of the Swift.org open source project
//
// Copyright (c) 2014 - 2024 Apple Inc. and the Swift project authors
// Licensed under Apache License v2.0 with Runtime Library Exception
//
// See https://swift.org/LICENSE.txt for license information
// See https://swift.org/CONTRIBUTORS.txt for the list of Swift project authors
//
//===----------------------------------------------------------------------===//
//
// This file defines macros used for macro-metaprogramming with type attributes.
//
//===----------------------------------------------------------------------===//

// A type attribute that is both a simple type attribute and a
// SIL type attribute (see below).  Delegates to SIL_TYPE_ATTR if that
// is set and SIMPLE_TYPE_ATTR is not; otherwise delegates to SIMPLE_TYPE_ATTR.
#ifndef SIMPLE_SIL_TYPE_ATTR
#ifdef SIL_TYPE_ATTR
#ifdef SIMPLE_TYPE_ATTR
#error ambiguous delegation, must set SIMPLE_SIL_TYPE_ATTR explicitly
#else
#define SIMPLE_SIL_TYPE_ATTR(SPELLING, CLASS, BEHAVIOR) SIL_TYPE_ATTR(SPELLING, CLASS, BEHAVIOR)
#endif
#else
#define SIMPLE_SIL_TYPE_ATTR(SPELLING, CLASS, BEHAVIOR) SIMPLE_TYPE_ATTR(SPELLING, CLASS, BEHAVIOR)
#endif
#endif

// Any kind of type attribute.
#ifndef TYPE_ATTR
#define TYPE_ATTR(SPELLING, CLASS, BEHAVIOR)
#endif

// A type attribute that is only valid in SIL mode.  Usually this means
// that it's only valid in lowered types, but sometimes SIL files
// also allow things in formal types that aren't normally expressible.
#ifndef SIL_TYPE_ATTR
#define SIL_TYPE_ATTR(SPELLING, CLASS, BEHAVIOR) TYPE_ATTR(SPELLING, CLASS, BEHAVIOR)
#endif

// A type attribute that's always just spelled `@identifier` in source.
#ifndef SIMPLE_TYPE_ATTR
#define SIMPLE_TYPE_ATTR(SPELLING, CLASS, BEHAVIOR) TYPE_ATTR(SPELLING, CLASS, BEHAVIOR)
#endif

#ifndef LAST_TYPE_ATTR
#define LAST_TYPE_ATTR(CLASS)
#endif

// Type attributes
SIMPLE_TYPE_ATTR(autoclosure, Autoclosure, 0ull)
TYPE_ATTR(convention, Convention, 0ull)
SIMPLE_TYPE_ATTR(escaping, Escaping, 0ull)
TYPE_ATTR(differentiable, Differentiable, 0ull)
SIMPLE_TYPE_ATTR(noDerivative, NoDerivative, 0ull)
SIMPLE_TYPE_ATTR(Sendable, Sendable, 0ull)
SIMPLE_TYPE_ATTR(retroactive, Retroactive, 0ull)
SIMPLE_TYPE_ATTR(unchecked, Unchecked, 0ull)
SIMPLE_TYPE_ATTR(preconcurrency, Preconcurrency, 0ull)
SIMPLE_TYPE_ATTR(unsafe, Unsafe, 0ull)
TYPE_ATTR(_lifetime, Lifetime, AllowMultipleAttributes)
SIMPLE_TYPE_ATTR(_local, Local, 0ull)
SIMPLE_TYPE_ATTR(_noMetadata, NoMetadata, 0ull)
TYPE_ATTR(_opaqueReturnTypeOf, OpaqueReturnTypeOf, 0ull)
TYPE_ATTR(isolated, Isolated, 0ull)
SIMPLE_TYPE_ATTR(nonisolated, Nonisolated, 0ull)
SIMPLE_TYPE_ATTR(_addressable, Addressable, 0ull)
SIMPLE_TYPE_ATTR(concurrent, Concurrent, 0ull)

// SIL-specific attributes
SIMPLE_SIL_TYPE_ATTR(async, Async, 0ull)
SIMPLE_SIL_TYPE_ATTR(block_storage, BlockStorage, 0ull)
SIMPLE_SIL_TYPE_ATTR(box, Box, 0ull)
SIMPLE_SIL_TYPE_ATTR(dynamic_self, DynamicSelf, 0ull)
#define REF_STORAGE(Name, name, ...) SIMPLE_SIL_TYPE_ATTR(sil_##name, SIL##Name, 0ull)
#include "swift/AST/ReferenceStorage.def"
SIMPLE_SIL_TYPE_ATTR(error, Error, 0ull)
SIMPLE_SIL_TYPE_ATTR(error_indirect, ErrorIndirect, 0ull)
SIMPLE_SIL_TYPE_ATTR(error_unowned, ErrorUnowned, 0ull)
SIMPLE_SIL_TYPE_ATTR(out, Out, 0ull)
SIMPLE_SIL_TYPE_ATTR(direct, Direct, 0ull)
SIMPLE_SIL_TYPE_ATTR(in, In, 0ull)
SIMPLE_SIL_TYPE_ATTR(inout, Inout, 0ull)
SIMPLE_SIL_TYPE_ATTR(inout_aliasable, InoutAliasable, 0ull)
SIMPLE_SIL_TYPE_ATTR(in_guaranteed, InGuaranteed, 0ull)
SIMPLE_SIL_TYPE_ATTR(in_cxx, InCXX, 0ull)
SIMPLE_SIL_TYPE_ATTR(in_constant, InConstant, 0ull)
SIMPLE_SIL_TYPE_ATTR(noescape, NoEscape, 0ull)
SIMPLE_SIL_TYPE_ATTR(pack_owned, PackOwned, 0ull)
SIMPLE_SIL_TYPE_ATTR(pack_guaranteed, PackGuaranteed, 0ull)
SIMPLE_SIL_TYPE_ATTR(pack_inout, PackInout, 0ull)
SIMPLE_SIL_TYPE_ATTR(pack_out, PackOut, 0ull)
SIMPLE_SIL_TYPE_ATTR(owned, Owned, 0ull)
SIMPLE_SIL_TYPE_ATTR(unowned_inner_pointer, UnownedInnerPointer, 0ull)
SIMPLE_SIL_TYPE_ATTR(guaranteed, Guaranteed, 0ull)
SIMPLE_SIL_TYPE_ATTR(guaranteed_address, GuaranteedAddress, 0ull)
SIMPLE_SIL_TYPE_ATTR(autoreleased, Autoreleased, 0ull)
SIMPLE_SIL_TYPE_ATTR(callee_owned, CalleeOwned, 0ull)
SIMPLE_SIL_TYPE_ATTR(callee_guaranteed, CalleeGuaranteed, 0ull)
SIMPLE_SIL_TYPE_ATTR(objc_metatype, ObjCMetatype, 0ull)
SIL_TYPE_ATTR(opened, Opened, 0ull)
SIL_TYPE_ATTR(pack_element, PackElement, 0ull)
SIMPLE_SIL_TYPE_ATTR(pseudogeneric, Pseudogeneric, 0ull)
SIMPLE_SIL_TYPE_ATTR(unimplementable, Unimplementable, 0ull)
SIMPLE_SIL_TYPE_ATTR(yields, Yields, 0ull)
SIMPLE_SIL_TYPE_ATTR(yield_once, YieldOnce, 0ull)
SIMPLE_SIL_TYPE_ATTR(yield_once_2, YieldOnce2, 0ull)
SIMPLE_SIL_TYPE_ATTR(yield_many, YieldMany, 0ull)
SIMPLE_SIL_TYPE_ATTR(captures_generics, CapturesGenerics, 0ull)
// Used at the SIL level to mark a type as moveOnly.
SIMPLE_SIL_TYPE_ATTR(moveOnly, MoveOnly, 0ull)
SIMPLE_SIL_TYPE_ATTR(sil_isolated, SILIsolated, 0ull)
SIMPLE_SIL_TYPE_ATTR(sil_sending, SILSending, 0ull)
SIMPLE_SIL_TYPE_ATTR(sil_implicit_leading_param, SILImplicitLeadingParam, 0ull)

// SIL metatype attributes.
SIMPLE_SIL_TYPE_ATTR(thin, Thin, 0ull)
SIMPLE_SIL_TYPE_ATTR(thick, Thick, 0ull)

LAST_TYPE_ATTR(Thick)

#undef SIMPLE_SIL_TYPE_ATTR
#undef SIMPLE_TYPE_ATTR
#undef SIL_TYPE_ATTR
#undef TYPE_ATTR
#undef LAST_TYPE_ATTR
